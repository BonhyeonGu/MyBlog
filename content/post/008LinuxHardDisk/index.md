---
title: "리눅스 하드디스크 문제"
description: "마운트, 검사, 오류해결, 백업등의 겪은일을 기반으로 한 정리입니다."
date: 2022-03-01T23:17:11+09:00
categories: ["리눅스"]
tags: ["dump", "mount", "fsck", "fstab"]
image: "thum.png"
draft: false
---
## Mount

### 설명

mount는 특정 저장장치를 디렉토리와 연결하는 행위입니다. 윈도우는 알아서 해주거나, 파일 관리자를 거쳐 해결할 수 있으며  
요즘 리눅스들은 사용자 편의를 위해 알아서 데스크탑에 mount 하게 됩니다.  

물론 mount를 하여 제대로 쓰기 위해선 fdisk와 같은 명령어로 포멧, 파일시스템 구축이 완료된 상태여야 합니다.

### Mount 상태 확인

```bash
findmnt
```

*mount -l* 도 있지만 위의 명령어가 훨씬 보기 편리합니다.

### Mount 하기

```bash
mount /dev/<장치명> <마운트 포인트>
```

취소는

```bash
umount /dev/<장치명>
```

하지만 위의 명령어는 일시적이며 reboot 후 필요하다면 다시 입력해야 합니다.

### fstab-파일시스템 테이블

부팅 시 자동으로 mount가 되기 위해선 해당 파일을 수정해야 합니다.

```bash
nano /etc/fstab
```

![fstab](1.png)

기본적인 mount 는 하단에 *<장치명> <마운트 포인트> <파일 시스템 종류> <옵션>* 을 추가하면
reboot 후부터 적용됩니다.

주의해야 할 사항이 있는데  
만약 현재 ssh등의 방법으로 remote중에 이것을 변경했다면 **반드시 오탈자가 없는지 확인해야 합니다.**  

만약 오타가 존재한다면 리눅스가 reboot 중에 SSH server를 포함한 프로세스를 실행하기 전 오류로 중단되므로  
담당자가 remote를 하지 못하고 직접 가서 local상으로 부팅 설정을 해야 하는 상황이 발생합니다.

## 하드디스크의 문제

### 설명

불량, 노후화, 최악에는 소프트웨어의 오류에도 하드디스크에 치명적인 문제가 발생할 수 있습니다.  
제가 겪은 문제는 서버가 일종의 과부하를 받을 때 디렉토리 일부가 사라져 조회조차 하지 못하는 상황에  
놓이는 것이였습니다.

놀라서 umount하거나 reboot해서 돌아와보면 디렉토리가 다시 보였지만  
디렉토리를 포함한 파일의 일부가 열리지만 소실되었거나, 열리지도 않으며 청소가 필요하다는 경고가 나타났습니다.  
흥미로웠던 사실은 최근에 생성된 것만 그런 상태였습니다. 추정해보면 EXT파일시스템의 특징이  

여기서 보이는 것이 아닐까 생각했습니다.
현재는 과거의 사태에 높은 확률을 따라, 하드디스크의 불량이라고 생각하고 있지만  
정확한 원인을 알기는 어려운 상황입니다. 이런일이 발생한다면 어떻게 대처하고 판단해야하는지  
작성해 보겠습니다.

### fsck

fsck는 리눅스에서 지원하는 Filesystem fix 명령입니다. 실행하면 체크를 하고, 문제가 생긴 항목을 불러준 뒤  
허락하면 교정을 시작합니다. 당연히 un mount 되어있는 상황이여야 합니다.

```bash
umount /dev/<장치명>
fsck -y /dev/<장치명>
```

Yes 또는 No로 물어보는 항목이 많고 대부분 오래 걸리므로 -y를 붙여 진행할 수 있습니다.

### badblocks

badblocks는 리눅스에서 기본적으로 하드디스크의 badblock을 점검해주는 명령어 입니다.  
어차피 읽기 전용모드로 작동되기 때문에 un mount 되어 있을 필요는 없으나  
항상 장치적 문제를 해결할 때는 un mount 하시는 것을 추천드리고 싶습니다.

```bash
umount /dev/<장치명>
badblocks -v -o out.txt /dev/<장치명>
```

-v는 자세하게 보여달라는 뜻이고 -o는 badblock list 를 file output으로 해달라는 뜻입니다.

### smartctl

smartctl은 기본 제공은 아니지만 자주 사용했었던 것입니다.  
하드디스크의 모니터링 기술 SMART(Self-Monitoring, Analysis, and Reporting Technology)을 사용하여  
점검하는 도구이며 아주 옛날의 하드디스크가 아닌 이상 대부분 장착되어 있습니다.

```bash
apt-get install smartmontools
umount /dev/<장치명>
smartctl -a /dev/<장치명>
```

자세히는 -a, 간단히는 -H, 정보만은 -i 옵션을 사용하여 진행 가능합니다.
